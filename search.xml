<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[spider]]></title>
    <url>%2F2019%2F10%2F31%2Fspider%2F</url>
    <content type="text"><![CDATA[0x00 爬虫基本架构HTML下载器: 获取新页面内容 HTML解析器: 解析新内容中的url url管理器: 管理url,去重,提供新的url来爬取 输出器: 将数据收集保存或输出 0x01 爬虫相关库BeautifulSoup12soup = BeautifulSoup(cont, 'html.parser', from_encoding='utf-8') # 创建soup对象links = soup.find_all('a', href=re.compile(r'')) # soup对象的find_all遍历文档树,查找'a'标签,href支持正则匹配 urllib.request12345req = urllib.request.Request(url) # Request函数构造请求req.add_header('User-Agent', 'something') # 修改请求头response = urllib.request.urlopen(req) # 发送请求response.getcode() # 获取请求返回码response.read() # 获取返回的内容 0x02 爬虫示例123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131from bs4 import BeautifulSoupimport urllib.requestimport reimport urllib.parsefrom functools import cmp_to_keydef cmp(x, y): if x['time'] &lt; y['time']: return -1 elif x['time'] &gt; y['time']: return 1 else: return 0class HtmlDownloader(object): def download(self, new_url): if new_url is None: return None req = urllib.request.Request(new_url) req.add_header('User-Agent', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.75 Safari/537.36') response = urllib.request.urlopen(req) if response.getcode() != 200: return None return response.read()class HtmlParser(object): def parse(self, new_url, cont): if new_url is None or cont is None: return None, None soup = BeautifulSoup(cont, 'html.parser', from_encoding='utf-8') urls = self._get_new_urls(new_url, soup) data = self._get_new_data(new_url, soup) return urls, data def _get_new_urls(self, new_url, soup): urls = set() links = soup.find_all('a', href=re.compile(r'.*')) for link in links: url = link['href'] full_url = urllib.parse.urljoin(new_url, url) urls.add(full_url) return urls def _get_new_data(self, new_url, soup): try: data = &#123;&#125; data['url'] = new_url data['content'] = soup.find('p').get_text() return data except: return Noneclass UrlManager(object): def __init__(self): self.new_urls = set() self.old_urls = set() def has_new_url(self): return len(self.new_urls) != 0 def add_url(self, url): if url is None: return if url not in self.old_urls and url not in self.new_urls: self.new_urls.add(url) def get_new_url(self): url = self.new_urls.pop() self.old_urls.add(url) return url def add_urls(self, urls): if urls is None: return for url in urls: self.add_url(url)class HtmlOutputer(object): def __init__(self): self.data = [] def _process(self, s): return ''.join(s.split()) def collect(self, data): if data is None: return for key in data: data[key] = self._process(data[key]) self.data.append(data) def get_data(self): return sorted(self.data, key=cmp_to_key(cmp), reverse=True)class Spider(object): def __init__(self): self.downloader = HtmlDownloader() self.parser = HtmlParser() self.manager = UrlManager() self.outputer = HtmlOutputer() def craw(self, num): if num == 0: return root_url = 'https://www.example.com' count = 0 self.manager.add_url(root_url) try: while self.manager.has_new_url(): new_url = self.manager.get_new_url() cont = self.downloader.download(new_url) urls, data = self.parser.parse(new_url, cont) self.manager.add_urls(urls) self.outputer.collect(data) count += 1 if count == num: break except: print('Craw failed')if __name__ == '__main__': num = int(input('Input num: ')) spider = Spider() spider.craw(num)]]></content>
      <categories>
        <category>学习记录</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[django部署]]></title>
    <url>%2F2019%2F10%2F30%2Fdjangoenv%2F</url>
    <content type="text"><![CDATA[Django环境搭建以下基于Python3和Django2.2版本,对低版本不具有参考性 0x00 配置虚拟环境1pip3 install virtualenv virtualenvwrapper 之后修改环境变量(如.bashrc),加入 1234export WORKON_HOME=$HOME/.virtualenvsexport PROJECT_HOME=$HOME/workspaceexport VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3source /usr/local/bin/virtualenvwrapper.sh 修改后重新加载环境变量文件 1source ~/.bashrc 虚拟环境相关指令mkvirtualenv env3 创建新环境env3 mkvirtualenv env3 —python=python3(.x) 创建python3版本的环境 workon env3 使用env3环境 deactivate 退出env3环境 rmvirtualenv env3 删除env3 mkproject mine 创建mine项目和mine环境 lsvirtualenv 列出可用虚拟环境 lssitepackages 列出当前环境安装的包 0x01 安装Django1pip3 install Django 测试安装是否成功: 12import djangodjango.get_version() 输出版本号即安装完成 0x02 新建Django项目1django-admin startproject myproject 或者写django-admin.py 项目名称应为Python合法包名 0x03 新建app12cd myprojectpython manage.py startapp myapp 0x04 运行开发服务器1python manage.py runserver 0x05 静态文件静态文件是指js,css,图片等文件 首先,打开settings.py,添加 1234567891011121314151617181920212223# Static files (CSS, JavaScript, Images)# https://docs.djangoproject.com/en/1.8/howto/static-files/ STATIC_URL = '/static/' # 当运行 python manage.py collectstatic 的时候# STATIC_ROOT 文件夹 是用来将所有STATICFILES_DIRS中所有文件夹中的文件，以及各app中static中的文件都复制过来# 把这些文件放到一起是为了用apache等部署的时候更方便STATIC_ROOT = os.path.join(BASE_DIR, 'collected_static') # 其它 存放静态文件的文件夹，可以用来存放项目中公用的静态文件，里面不能包含 STATIC_ROOT# 如果不想用 STATICFILES_DIRS 可以不用，都放在 app 里的 static 中也可以STATICFILES_DIRS = ( os.path.join(BASE_DIR, "common_static"), '/path/to/others/static/', # 用不到的时候可以不写这一行) # 这个是默认设置，Django 默认会在 STATICFILES_DIRS中的文件夹 和 各app下的static文件夹中找文件# 注意有先后顺序，找到了就不再继续找了STATICFILES_FINDERS = ( "django.contrib.staticfiles.finders.FileSystemFinder", "django.contrib.staticfiles.finders.AppDirectoriesFinder") 部署时,需要收集静态文件 1python manage.py collectstatic uwsgi部署0x00 安装uwsgi12sudo apt install python3-devsudo pip3 install uwsgi 安装完成后 1uwsgi --python-version 版本与要使用的python相同即可 0x01 配置ini文件123456789101112131415161718192021222324# mysite_uwsgi.ini file[uwsgi]virtualenv = /home/admin/.virtualenvs/env3 # Your virtualenv path# Django-related settings# the base directory (full path)chdir = /home/admin/myproject # Your project path# Django's wsgi filemodule = myproject.wsgi # project's name .wsgi# the virtualenv (full path)# home = /home/admin/.virtualenvs/reload# process-related settings# mastermaster = true# maximum number of worker processesprocesses = 2# the socket (use the full path to be safe)http = :8080 # 用于http直接访问socket = /home/admin/myproject/myproject.sock # 用于配合nginx# 或者 socket = ip:端口pidfile = /home/admin/myproject/uwsgi.pid # 生成pid文件,用于进程管理# ... with appropriate permissions - may be needed# chmod-socket = 664# clear environment on exitvacuum = true 0x02 运行uwsgi1uwsgi --ini uwsgi.ini uwsgi指令uwsgi -d —ini uwsgi.ini 后台运行uwsgi uwsgi —reload xxx.pid 重新加载 uwsgi —stop xxx.pid 停止进程 查看端口占用情况1lsof -i :8000 查找进程1ps aux | grep uwsgi 停止进程1sudo kill -9 PID nginx部署0x00 安装nginx1sudo apt install nginx 安装后访问ip,显示nginx欢迎页面即说明安装成功 0x01 新建网站首先在项目路径下新建 uwsgi_params 文件,内容如下 1234567891011121314151617uwsgi_param QUERY_STRING $query_string;uwsgi_param REQUEST_METHOD $request_method;uwsgi_param CONTENT_TYPE $content_type;uwsgi_param CONTENT_LENGTH $content_length;uwsgi_param REQUEST_URI $request_uri;uwsgi_param PATH_INFO $document_uri;uwsgi_param DOCUMENT_ROOT $document_root;uwsgi_param SERVER_PROTOCOL $server_protocol;uwsgi_param REQUEST_SCHEME $scheme;uwsgi_param HTTPS $https if_not_empty;uwsgi_param REMOTE_ADDR $remote_addr;uwsgi_param REMOTE_PORT $remote_port;uwsgi_param SERVER_PORT $server_port;uwsgi_param SERVER_NAME $server_name; 之后 1sudo vim /etc/nginx/sites-available/mysite.conf 写入 12345678910111213141516171819202122232425262728293031323334# myproject.conf # the upstream component nginx needs to connect toupstream django &#123; server unix:///home/admin/myproject/myproject.sock; # for a file socket # server 127.0.0.1:8001; # for a web port socket 端口与uwsgi的socket配置相同&#125;# configuration of the serverserver &#123; # the port your site will be served on listen 8000; # the domain name it will serve for server_name 207.148.123.145; # substitute your machine's IP address or FQDN charset utf-8; # max upload size client_max_body_size 75M; # adjust to taste # Django media # location /media &#123; # alias /path/to/your/mysite/media; # your Django project's media files - amend as required # &#125; location /static &#123; alias /home/admin/myproject/collected_static; # your Django project's static files - amend as required &#125; # Finally, send all non-media requests to the Django server. location / &#123; uwsgi_pass django; include /home/admin/myproject/uwsgi_params; # the uwsgi_params file you installed 与上文写的文件路径相同 &#125;&#125; media和static路径不需要可不写]]></content>
      <categories>
        <category>学习记录</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>uwsgi</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[html&css]]></title>
    <url>%2F2019%2F09%2F27%2Fhtmlcss%2F</url>
    <content type="text"><![CDATA[(前端果然是体力活) html基础标签&lt;p&gt;这种的是标签,而&lt;p&gt;something&lt;/p&gt;称为元素 span vs div&lt;div&gt;是block-level的元素，span是inline-level的元素(并不知道汉语应该怎么说，因为被推荐的教程是英文的) strong vs em&lt;strong&gt;使内容加粗，&lt;em&gt;使内容斜体。 article用来标记一段可以单独取出而不产生歧义的语段 section用于大纲等有着逻辑关系的组里 aside侧边位置的容器 附: small可以用来写旁注和copyright&amp;copy;即&copy;123&lt;footer&gt; &lt;small&gt;&amp;copy; Styles Conference&lt;/small&gt;&lt;/footer&gt; a用来添加链接和页内跳转&lt;a href=&quot;#&quot;&gt;...&lt;/a&gt;不要把href写成herf css待续]]></content>
      <categories>
        <category>学习记录</category>
      </categories>
      <tags>
        <tag>html</tag>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python]]></title>
    <url>%2F2019%2F09%2F21%2Fpython%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[好久没有写博客了，总结一下python写程序时遇到的知识点和问题。 base64库base64.b64encode(string)接受参数string应为byte型，str类型需转换，如string.encode(‘utf-8’) base64.b64decode(string)同上，字符串应为byte型，注意可加参数validate,true表示遇到非法字符抛出异常，false表示遇到非法字符忽略，默认false。如base64.b64decode(s,validate=True)注意binascii.Error是在base64命名空间下，所以except要写成except base64.binascii.Error 常见异常：UnicodeEncodeErrorbase64.binascii.Error 字符串处理split()s.split(‘char’)返回一个数组，为以char分割后的各个字符串。可选参数：指定分割次数，默认为-1，即分割所有。如s.split(‘char’,1) strip()用于除去字符串两端的字符s.strip()表示除去两端的空格s.strip(‘1’)即除去字符串两端的’1’ 切片注意左开右闭s[1:-1]不包含最后一个字符，s[-1]为提取最后一个字符 常见异常IndexError 图片处理注意调库Image在PIL里，所以写成from PIL import Image Image.open()返回一个pil里的img类型，写的时候注意参数的类型变化 获取图片的宽高对一个上述Image.open()返回值类型的变量，可以用.size方法，如1width,height=tmp.size 图片原比例缩放当时写qrcode制作的时候，因为文本量太大，所以生成的qrcode过大，此时将图片缩放应该是比设计滚动条更好的选(其实是我不会给Label加滚动条)1234567def resize(w,h,nw,nh,img): a=1.0*nw/w #用1.0是为了强制转化为浮点数运算 b=1.0*nh/h div=min(a,b) fw=int(w*div) fh=int(h*div) return img.resize((fw,fh),Image.ANTIALIAS) img类型应为Image.open()的返回值类型Image.ANTIALIAS高质量Image.NEAREST低质量 os库1os.system(order) order即控制台运行的指令注意，如果要在A程序里打开B,最好新建一个控制台，即1os.system(start python b.py) 因为这样直接关闭B程序不会导致A程序接受不到B程序执行结束的反馈而崩溃。(貌似我因为这样写弄崩了评测学长的命令行)1os.getcwd() 这个可以获取当前的py文件所在路径 GUI学习GUI真是个大坑啊，尤其是库里出了问题，全凭google救命 tkinter第一次写GUI用的就是这个库，大概优点是python里自带，不用额外安装库，操作简单。不过界面挺简陋的(俺的第一次GUI被说界面丑)PS:python3 里 写作tkinter，老版本写作Tkinter Tk()创建一个窗口，如1root=Tk() titletitle就是打开的窗口左上角显示的文字1root.title('I love python') Button控件新建一个按钮控件1Button(root,text='',command=click,height=h,width=w,activeforeground='color') master是按钮控件要加入的窗口，text为按钮显示的文本，command为按钮点击时触发的函数，width,height为按钮的宽高activeforeground为点击时的前景色。 Label控件新建一个用户不可选中的显示区，可以用来显示图片和文字 显示文字1Label(root,text) 含义同上 显示图片12img=ImageTk.PhotoImage(Image.open(path))Label(image=img) ImageTk,Image在PIL库里Label会根据图片的大小自动改变大小 Text控件新建一个可以被用户选中的显示文本或图片的控件1e1=Text(root,height=a,width=b) 参数含义同上 获取Text内的文字1e1.get(0.0,END) 第一个参数是开始的(行.列)第二个参数同理，可以用END来替代结尾 注意Text会在文本最后额外添加一个换行符 Text文本内容的修改12e1.delete(0.0,END)e1.insert(0.0,s) insert参数中第一项为插入位置，第二项为插入的字符串 动态修改Label,Button都是可以动态修改的1A.config(a=b) config里是需要修改的参数这里有个坑,在Label动态修改图片时，要这样写12imglabel.config(image=img)imglabel.image=img 如果少写第二行，就会出现虽然Label已经根据图片调整了大小，但是还是无法显示图片的bug。这个bug好像是因为库里有的引用忘记修改了，大概是库函数的锅。。。 tkinter布局管理pack()这个比较简单，就是自动排布，默认累成一列，可再加参数更改排布方式如:1A.pack() grid()grid可以略微精准一点来控制布局，它将界面分成小格，row表示行数，column表示列数，可以增加sticky参数来确定在单独一个格里的分布如:1a.grid(row=1,column=1,sticky=W) 注意pack和grid不能混合使用，只能二者取一 增加滚动条目前还只会给Text增加垂直滚动条123456e1=Text(root,height=15,width=100)S=Scrollbar(root)S.grid(row=0,column=1,sticky=E,ipady=70)e1.grid(row=0,column=1,sticky=W,padx=20)S.config(command=e1.yview)e1.config(yscrollcommand=S.set) 打开文件选取框12import tkinter.filedialogfilepath=tkinter.filedialog.askopenfilename() filepath是带着当前文件的全名的(包括扩展名) 运行窗口1root.mainloop() 识别文件的编码格式并打开12345import chardetwith open(filepath,'rb') as tf: nowencode=chardet.detect(tf.read())['encoding']with open(filepath,encoding=nowencode) as f: s=f.read() 这样防止乱码问题 待续]]></content>
      <categories>
        <category>学习记录</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ctf工具总结]]></title>
    <url>%2F2019%2F09%2F12%2Fctf%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[1.ZipCenOp.jar用于判断压缩包是否为伪加密 指令:java -jar ZipCenOp.jar r xxx.zip decodejava -jar ZipCenOp.jar e xxx.zip encode 待续]]></content>
      <tags>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP漏洞总结]]></title>
    <url>%2F2019%2F09%2F11%2FPHPbug%2F</url>
    <content type="text"><![CDATA[php审计—从入门到入坟 extract() extract()函数从数组中将变量导入到当前的符号表。该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。如果有重复则覆盖 效果:1234567&lt;?php$a = "a";$my_array = array("a" =&gt; "Cat","b" =&gt; "Dog", "c" =&gt; "Horse");extract($my_array);echo "\$a = $a; \$b = $b; \$c = $c";//$a=Cat $b=Dog $c=Horse?&gt; 通过变量覆盖解决问题。 strcmp() 在php5.3版本前，如果参数中传入非字符串内容，则直接return 0 伪造字符串相等 md5() 若要求md5值弱相等，则可构造哈希值为0E开头的字符串，此时直接视作为0。如果是强相等，则构造数组，此时返回NULL常见构造字符串: QNKCDZO 240610708 s878926199a s155964671a s214587387a s214587387a 注意是强相等还是弱相等 ereg() ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。如果参数为数组则返回NULL，遇到%00截断 strpos() 寻找表达式出现的第一个位置,如果参数为数组返回NULL 注意如果下标为0等价false is_numric() is_numric用于判断是否为纯数字，遇到%00直接判定为非数字，无关%00位置 ps:关于%00 %00是字符串的结尾，然而输出时遇到%00不停止。$_GET数组得到的是字符串，当出现 (string)1%00==1等类似语句时，会将string转换为数字，并且遇到%00停止。如果字符串无法转换为数字，就视作0。 update time:9.21 sha1() sha1()以数组为参数时，会返回NULL 比较转换 16进制与10进制比较，转换为10进制 附: strlen() strlen()以数组为参数时返回NULL eval() 该函数将接受的参数视作php语句，构造表达式闭合其括号 @$_GET[‘a’]这个不算bug,@的含义是忽略该表达式可能生成的错误消息 待续]]></content>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[FirstBlog]]></title>
    <url>%2F2019%2F09%2F11%2FFirstBlog%2F</url>
    <content type="text"><![CDATA[FirstBlog终于在自习室搞完了。。。初次尝试hexo,慢慢摸索吧。==zyf sb==yc nbzyf nbyc sb$ \sum_{i=1}^n i^2 $ \begin{aligned} \vert y_n-A \vert &= \vert \frac{\left(x_1-A \right)+\left(x_2-A\right)+\ldots+\left( x_n-A \right)}{n} \vert \\ &= \vert \frac{\left(x_1-A \right)+\left(x_2-A\right)+\ldots+\left(x_{N_0}-A\right)+\left(x_{N_0+1}-A\right)+\ldots+\left( x_n-A \right)}{n} \vert \\ &\le |\frac{\left(x_1-A\right)+(x_2-A)+\ldots+(x_{N_0}-A)}{n}|+\frac{n-N_0}{n}\cdot\frac{\epsilon}{2} \\ &\lt|\frac{(x_1-A)+(x_2-A)+\ldots+(x_{N_0}-A)}{n}|+\frac{\epsilon}{2} \end{aligned}来自WHU高数P20]]></content>
  </entry>
</search>
